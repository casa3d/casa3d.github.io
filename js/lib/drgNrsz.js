dr={crs:"",d:document,w:window,pj:new T.Projector,style:".drg{cursor:url(cur/drg.cur),auto}.drgn{cursor:url(cur/drgn.cur),auto}.e-rz{cursor:e-resize}.n-rz{cursor:n-resize}.nw-rz{cursor:nw-resize}.sw-rz{cursor:sw-resize}",V3:new T.Vector3(0,0,.5),act:function(){dr.app=dr.app?(dr.m&&(dr.m.emissive.g--,dr.o=void 0),dr.d.body.className="idle",$(".trgt").removeClass("not"),!1):($(".trgt").addClass("not"),dr.d.body.className=dr.drg.crs,!(m.rKey=!1))},intrsct:function(){dr.o!=dr.new&&(dr.o&&dr.o.material.emissive.g--,(dr.m=(dr.o=dr.new).material).emissive.g+=1)},cursor:function(){var r=$("style")[0];r?r.innerHTML+="\n"+dr.style:$(dr.d.head).append(style=$("<style>").text(dr.style))},rc:function(){return dr.pj.unprojectVector(dr.V3,c),dr.rC=new T.Raycaster(c.position,dr.V3.sub(c.position).normalize()),dr.rst=dr.rC.intersectObjects(t.s.children,!0)[0],dr.rst&&dr.rst.object&&dr.rst.object.parent&&4==dr.rst.object.parent.id?0:dr.rst},drg:{crs:"drg",rv:1,init:function(){var r=dr.rst.point,d=dr.rsz.point;if(Math.abs(r.z-d.z)<50){var o=dr.drg.o,t=o.position,e=dr.cover,s=e.position;o.geometry instanceof T.ShapeGeometry&&(r.x-=o.parent.position.x,r.y-=o.parent.position.y),t.x=r.x,dr.drg.z?t.z+=o.rotation.x?r.z-d.z:o.rotation.y?dr.new.rotation.y?r.z-d.z:d.y-r.y:d.y-r.y:o.rotation.x?dr.new.id==o.id?(dr.follow(),s.y+=s.y<c.position.y?.1:-.1):dr.new.id!=e.id?Math.abs(t.y-r.y)<100&&(t.y=r.y):t.y>s.y&&t.y<c.position.y?s.y+=2*(t.y-s.y):t.y+=(d.z-r.z)*(t.y>c.position.y?-1:1):t.y=r.y}}},follow:function(r){for(var d in{x:0,y:0,z:1})dr.cover.position[d]=r?"z"==d?-600.1:0:dr.new.position[d],dr.cover.rotation[d]=r?0:dr.new.rotation[d]},rsz:{app:!1,δ:function(r){var d=dr.rst?dr.o.position["v"==r?"y":dr.o.rotation.y?"z":"x"]-dr.rst.point["v"==r?"y":dr.o.rotation.y?"z":"x"]:15;return r?d:Math.abs(d)},brdr:function(){var r;return(dr.rsz.crs=(r=dr.o.geometry.width/2-dr.rsz.δ()<3)?"e-rz":!1)||(dr.rsz.crs=(r=dr.o.geometry.height/2-Math.abs(dr.rsz.δ("v"))<15)?"n-rz":!1)},centre:function(){var r,d,o,t,e,s,n=dr.o.geometry.vertices;if(s=function(r){return Math.abs(r)},s(n[0].x)!=n[1].x&&(r=!0,d=(s(n[0].x)+s(n[1].x))/2,dr.o.geometry.width=2*d,e=(Math.max(s(n[0].x),s(n[1].x))-Math.min(s(n[0].x),s(n[1].x)))/2,dr.rsz.Δ="",dr.o.position[dr.o.rotation.y?"z":"x"]+=e*(s(n[0].x)>s(n[1].x)?-1:1)),n[0].y!=s(n[2].y)&&(t=!0,o=(s(n[0].y)+s(n[2].y))/2,dr.o.geometry.height=2*o,e=(Math.max(s(n[0].y),s(n[2].y))-Math.min(s(n[0].y),s(n[2].y)))/2,dr.o.position.y+=e*(s(n[0].y)>s(n[2].y)?1:-1)),t||r)for(var i in n)r&&(dr.o.geometry.vertices[i].x=d*(i%2?1:-1)),t&&(dr.o.geometry.vertices[i].y=o*(2>i?1:-1));dr.o.geometry.verticesNeedUpdate=!0},init:function(){var r=dr.rsz.v="n-rz"==dr.rsz.crs?!0:"e-rz"==dr.rsz.crs?!1:dr.rsz.v;Δ=dr.rsz.δ(r?"v":!0),dr.rsz.Δ=Math.abs(Δ),dr.o.geometry.vertices[Δ>0?2:r?0:3][r?"y":"x"]=dr.o.geometry.vertices[Δ>0?r?3:0:1][r?"y":"x"]=-Δ,dr.o.geometry.verticesNeedUpdate=!0,dr.rsz.Δ<(dr.o.geometry.width>30?16:6)&&dr.rsz.centre()}},xy:function(r){dr.V3.x=2*(r.clientX/dr.w.innerWidth)-1,dr.V3.y=2*-(r.clientY/dr.w.innerHeight)+1}},$(dr.d).on({mousemove:function(r){dr.app&&(dr.xy(r),dr.rc(r)&&(dr.new!=dr.rst.object&&(dr.new=dr.rst.object),!dr.rsz.app&&dr.intrsct(),dr.drg.app?dr.drg.init():(dr.rsz.brdr()?dr.d.body.className!=dr.rsz.crs&&(dr.d.body.className=dr.rsz.crs):!dr.rsz.app&&dr.d.body.className!=dr.drg.crs&&(dr.d.body.className=dr.drg.crs),dr.rsz.app&&(dr.rsz.point&&dr.follow(),dr.rsz.init(dr.rsz.crs))),dr.rsz.point=dr.rst.point))},mousedown:function(){dr.app&&(dr.rsz.crs?dr.rsz.app=!0:(dr.d.body.className="drgn",dr.drg.o=dr.new,dr.drg.app=!0))},mouseup:function(){dr.app&&(dr.rsz.app||dr.drg.app)&&(dr.rsz.app&&(dr.rsz.app=!1,dr.rsz.Δ&&dr.rsz.centre(),dr.follow(1)),dr.drg.app&&(dr.drg.app=!1,dr.follow(1)),!dr.rsz.brdr()&&(dr.d.body.className=dr.drg.crs="drg"))},keydown:function(r){dr.app&&(dr.drg.z=r.ctrlKey)},keyup:function(r){dr.app&&(dr.drg.z=!1),77==r.keyCode&&dr.act()}}),dr.cursor(),t.ad({a:"12 24[!|]0 0 -600.1",p:h.ga}),dr.cover=t.shape;