o={d:document,w:window,W:innerWidth/100,H:innerHeight/100,gw:innerWidth/1e3,gh:innerHeight/1e3,l0p:innerHeight/10,f:"FullScreen",of:"brick door glass wall window wood".split(" "),g:new T.PlaneGeometry(100,200),m:new T.MeshBasicMaterial,sty:"canvas{left:0;position:fixed;top:0}canvas#cv{background:#FFF}canvas.ops{background:linear-gradient(rgba(0,0,0,.5)10.5%,transparent 10.5%,transparent 90.5%,rgba(0,0,0,.5)90.5%)}",tn:{blob:{}},tdp:{curveSegments:1,font:"janda manatee solid",height:1e-6,size:.2},usrAgnt:{Chrome:"webkit",Trident:"ms",Firefox:"moz"},Δ:[],clear:function(o,t,e){setTimeout(function(){clearInterval(o),console.log(t+"-renderer's been cleared")},e)},rb:function(t){for(var e,n,i,r=0;r<t.length;){n=!0,e=t[r++];for(var s in o.tn.blob)if(o.tn.blob[s].sz==e.size&&!(n=0))break;o.add(o.φ=n?o.w.URL.createObjectURL(e):s,!0,e.size)}i=setInterval(o.R,100),o.clear(i,"image-click",500)},ad:function(e,n){var i=c.position;t.ad("1 2["+(n?e:e.split(/img\/(.*)/)[1])+"]"+i.x/100+" "+(i.y+(o.txt.r.idx?0:-90))/100+" "+(i.z-150)/100+" "+o.txt.r[o.txt.r.idx]),c.position.y+=.1,c.position.z+=.1},add:function(t,e,n){var i,r,s,a,l,p;i=o.tx,t!=o.tx&&(o.txt.r.idx=o.o.parent.id-97),o.ad(o.tx=(e&&36==t.length?"blob:http%3A//localhost%3A3000/":"")+t,e),e&&36!=t.length&&(t=t.substr(31,t.length-1)),p=o.tn[t]||o.tn.blob[t],p?(o.tn.o=o.tns.children[p.id],o.txt.get(++p.x+"")):(e?o.tn.blob[t]={id:o.tns.children.length,sz:n,x:1}:o.tn[t]={id:o.tns.children.length,x:1},r=new T.PlaneGeometry(o.gw,o.gh),φ=e?T.ImageUtils.loadTexture(o.tx):o.o.material.map,s=new T.MeshBasicMaterial({map:φ}),o.s.children[1].add(a=new T.Mesh(r,s)),a.position.x=-o.gw*(49-(l=o.tns.children.length))+o.gw/2,a.N=[],l>9&&(o.tns.position.x-=o.gw),o.txt.init(a,0),o.tns.right-=o.gw)},cc:function(){var e,n=o.o.id-208;1!=n&&n||(e=t.s.__lights[0].color,n?e.b<1&&(e.b+=.15):e.b>.1&&(e.b-=.15),e.r=e.g=e.b)},mv:function(){o.st.rll.position.x+=o.o.id==o.left.id&&o.st.rll.position.x<27?o.pnlW:o.o.id==o.right.id&&o.st.rll.position.x>-27&&-o.pnlW},R:function(){o.r.render(o.s,o.c)},st:{app:!1,init:function(t){var e,n,i,r,s=0,a=[[],[]],l=[[],[]];for(a[0][3]=-(a[0][0]=3*(a[0][1]=-(a[0][2]=o.gw))),l[0][0]=-(l[0][3]=3*(l[0][2]=-(l[0][1]=o.gh))),a[1][0]=-(a[1][3]=.0123),a[1][1]=l[1][2]=-(a[1][2]=l[1][1]=.00498),l[1][3]=-(l[1][0]=.0085),o.pnlW=o.W-2*o.gw,o.pnlH=o.H-2*o.gh,e=new T.PlaneGeometry(o.W,o.pnlH),n=new T.MeshLambertMaterial({opacity:0,transparent:!0,visible:!1}),o.s.add(o.st.pnl=new T.Mesh(e,n)),o.st.pnl.position.y=-o.H,e=new T.PlaneGeometry(6*o.pnlW,o.pnlH),o.st.pnl.add(o.st.rll=new T.Mesh(e,n)),o.st.rll.position.set(o.st.rll.geometry.width/2-o.W/2+o.gw,0,1e-4),e=new T.PlaneGeometry(o.pnlW,o.pnlH);6>s;){var p=0;n=new T.MeshBasicMaterial({visible:!1}),o.st.rll.add(i=new T.Mesh(e,n)),i.position.x=3*-o.pnlW+o.pnlW/2+o.pnlW*s++}for(s=0,e=new T.PlaneGeometry(2*o.gw,2*o.gh);6>s;){for(var p=0;4>p;){var c=1,d=4*p;for(r=new T.ImageUtils.loadTexture("img/"+o.of[s]+"/"+d+".jpg"),n=new T.MeshBasicMaterial({map:r,opacity:.85,transparent:!0}),o.st.rll.children[s].add(i=new T.Mesh(e,n)),i.position.set(a[0][p]+a[1][p],l[0][0]+l[1][0],0);4>c;)r=new T.ImageUtils.loadTexture("img/"+o.of[s]+"/"+(c+d)+".jpg"),n=new T.MeshBasicMaterial({map:r,opacity:.85,transparent:!0}),o.st.rll.children[s].add(i=new T.Mesh(e,n)),i.position.set(a[0][p]+a[1][p],l[0][c]+l[1][c],0),c++;p++}s++}e=new T.PlaneGeometry(o.gw,o.pnlH),r=new T.ImageUtils.loadTexture("img/icon/left.png"),n=new T.MeshBasicMaterial({map:r,opacity:.3,transparent:!0}),o.st.pnl.add(o.left=new T.Mesh(e,n)),o.left.position.set(t,0,.001),o.st.pnl.add(o.right=o.left.clone()),o.right.rotation.z=Math.PI,o.right.position.set(-t,0,.001)}},s:new T.Scene,c:new T.PerspectiveCamera(innerHeight/(768/42),innerWidth/innerHeight,.001,10),r:new T.WebGLRenderer({antialias:!1}),pj:new T.Projector,V3:new T.Vector3(0,0,.5),o:{id:""},ops:[function(){o.mv()},function(){o.mv()},function(){o.st.pnl.position.y=o.st.pnl.position.y?(m.rKey&&m.act(),0):-o.H,o.st.app=!o.st.app},dr.act,function(){o.i.click()},m.act,m.rt,function(){m.rt(2)},function(){o.cc()},function(){o.cc()},function(){var t=new JSZip;t.add("casa3d.js",rQ.response).add("read me md.txt","export/import casa3d.js to casa3d.hostzi.com"),o.w.location.href="data:application/zip;base64,"+t.generate()},function(){o.d[o.is]?o.d[o.ex]():o.d.body[o.rq]()}],rc:function(t){if(o.V3.x=2*(t.clientX/o.w.innerWidth)-1,o.V3.y=2*-(o.y/o.w.innerHeight)+1,o.pj.unprojectVector(o.V3,o.c),o.rC=new T.Raycaster(o.c.position,o.V3.sub(o.c.position).normalize()),o.rst=o.rC.intersectObjects(o.s.children,!0),o.rst.length<5){var e;for(e in o.rst)if(o.rst[e].object.parent.id>96&&o.rst[e].object.parent.id<103)return o.rst=o.rst[e]}return o.rst=o.rst[2]?o.rst[0].object.id>o.rst[1].object.id?o.rst[0]:o.rst[1]:o.rst[0]},slide:function(){var t,e,n;o.app&&(e=o.tns,n=e.position.x,((t=o.x&&n>e.right)||!o.x&&n<e.left)&&(e.position.x-=t?.05:-.05,requestAnimationFrame(o.slide),o.R()))},txt:{init:function(t,e){for(var n;10>e;)t.N[e]=[n=new T.Mesh(new T.TextGeometry(e++,o.tdp),o.m)],n.position.x=-.65,n.position.y=.4,t.add(n)},hd:function(t,e){var n=t.length-1,i=o.tn.o.N[t[e=e?n-e:n]][e];i&&.4!=i.position.y&&(i.position.y=.4)},mv:function(t,e){var n=t.length-1,i=o.tn.o,r=i.N[t[e=e?n-e:n]];obj=r[e],!obj&&i.add(obj=r[e]=r[0].clone()),obj.position.set(o.Δ[e],.09,0)},lm:[],it:function(t,e,n){0==t[n-e]&&(o.txt.mv(t,e),t>o.txt.lm[e]&&(o.txt.hd(t-1+"",e),o.txt.it(t,e+1,n)))},get:function(t){o.txt.mv(t),o.txt.it(t,1,t.length),o.txt.hd(t-1+"")},r:"p  p p".split(/|/)},Y:function(t){return o.y=t.clientY,o.y<o.l0p||o.y>o.w.innerHeight-o.l0p},init:function(){var t,e,n,i,r,s,a,l=0,p=$("style")[0];for(p?p.innerHTML+=o.sty:$(o.d.head).append($("style").text(o.sty)),o.r.setSize(innerWidth,innerHeight),o.c.position.z=10,r=-o.W/2+o.gw/2,s=o.H/2-o.gh/2,o.st.init(r),t=new T.PlaneGeometry(96*o.gw,o.gh),e=new T.MeshBasicMaterial({opacity:0,transparent:!0}),o.s.add(o.tns=new T.Mesh(t,e)),o.tns.position.set(o.tns.left=43*o.gw,s,0),o.tns.right=o.tns.left+10*o.gw,t=new T.PlaneGeometry(o.gw,o.gh);10>l;)n=new T.ImageUtils.loadTexture("img/icon/icon.png"),n.repeat.x=.0989,n.offset.x=.0989*l,e=new T.MeshBasicMaterial({map:n}),i=new T.Mesh(t,e),i.position.set(r+l*o.gw,-s,0),o.s.add(i),l++;$(o.d.body).append(o.r.domElement),o.r.domElement.className="ops"+(u.a?'':'no'),o.pfx=o.usrAgnt[/(Chrome|Trident|Firefox)/.exec(o.w.navigator.userAgent)[0]],o.is=o.pfx+("webkit"==o.pfx?"Is":"")+o.f,o.ex=o.pfx+"Cancel"+o.f,o.rq=o.pfx+"Request"+o.f,o.tn.id=o.s.children[1].id;for(l in o.ops)o.ops[Number(l)+(2>l?o.left.id:o.tn.id-1)]=o.ops[l],delete o.ops[l];for(l in o.of)o.Δ[l]=-.62+.15*l,o.txt.lm[l]=2*Math.pow(10,l)-1;o.i=$("<input type=file accept=image/* multiple onchange=o.rb(this.files)>")[0],a=setInterval(o.R,500),o.clear(a,"ops",6e3)}},$(o.w).on({click:function(t){var e;(o.Y(t)||o.st.app)&&o.o.id&&(o.ops[o.o.id]?o.ops[o.o.id]():(o.o.id>102&&o.o.id<199||o.o.parent.id==o.tn.id)&&o.add(e=o.o.material.map.sourceFile,/blob/.test(e)),o.R())},mousemove:function(t){(o.Y(t)||o.st.app)&&(((o.x=t.clientX)<1||o.x>o.w.innerWidth-2)&&o.y<o.l0p?!o.app&&o.slide(o.app=!0):o.app&&(o.app=!1),o.rc(t)&&o.o.id!=o.rst.object.id&&(o.o.id&&(201==o.o.parent.id||o.o.parent.id>96&&o.o.parent.id<103?(o.o.position.z=0,o.o.material.opacity=.85):o.mc&&((o.mc=o.o.material.color).r=o.pc[0],o.mc.g=o.pc[1],o.mc.b=o.pc[2])),o.o=o.rst.object,201==o.o.parent.id||o.o.parent.id>96&&o.o.parent.id<103?(o.o.position.z=.125,o.o.material.opacity=1):(o.mc=o.o.material.color,o.pc=[o.mc.r,o.mc.g,o.mc.b],o.mc.r=o.mc.g=o.mc.b=0),o.R()))},resize:function(){o.r.setSize(o.w.innerWidth,o.w.innerHeight)}}),o.init();